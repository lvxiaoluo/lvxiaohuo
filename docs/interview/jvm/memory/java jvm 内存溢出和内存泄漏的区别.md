# java jvm 内存溢出和内存泄漏的区别

## **1、概念的区分**

### **`内存溢出 out of memory`**``

是指程序在申请内存时，没有足够的内存空间供其使用，出现 `out of memory` 。

比如申请了一个10MB 空间， 但是当前内存只有5MB，那就是内存溢出。

javadoc 对 `OutOfMemoryError` 的解释是， 没有空闲内存，垃圾收集器也无未能提供更多的内存空间 。

![图片](https://mmbiz.qpic.cn/mmbiz_png/3kMZppQa5zBBQWfsKDF7kjPiba1ibq69mKNLOzAs76xzR76of7tuufIs3icf4pOZmib8sdp9opMqBGP1O75asMHCsw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

### **`内存泄露 memory leak`**``

是指程序运行结束后，没有释放已所占用的内存空间，一次内存泄漏 似乎不会有大的影响，但内存泄漏 堆积后的后果就是 内存溢出。
![图片](https://mmbiz.qpic.cn/mmbiz_png/3kMZppQa5zBBQWfsKDF7kjPiba1ibq69mKkJVI3fXLqh8woNMwOc0vx5v8YHdcqwibSibAxYEL944HFVhwueRCtL5A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**1）单例模式**

单例的生命周期和应用程序是一样长的，所以单例程序中如果持有对外部对象的引用的话，那么这个外部对象是不能被回收的，则会导致内存泄露的产生。

**2）一些提供close的资源未闭导致内存泄漏**

数据库连接（dataSource.getConnection() ），网络连接（socket）和 IO流的连接必须在finally中 close，否则不能被回收的。

## **2、二者的关系：**

- 内存溢出就是你要的内存空间超过了系统实际分配给你的空间，此时系统相当于没法满足你的需求，就会报内存溢出的错误。

- 内存溢出：一个盘子用尽各种方法只能装4个果子，你装了5个，结果掉倒地上不能吃了。这就是溢出。比方说栈，栈满时再做进栈必定产生空间溢出，叫上溢，栈空时再做退栈也产生空间溢出，称为下溢。就是分配的内存不足以放下数据项序列,称为内存溢出。说白了就是我承受不了那么多，那我就报错。

- 内存泄漏是指你向系统申请分配内存进行使用(new)，可是使用完了以后却不归还(delete)，结果你申请到的那块内存你自己也不能再访问（也许你把它的地址给弄丢了），而系统也不能再次将它分配给需要的程序。就相当于你租了个带钥匙的柜子，你存完东西之后把柜子锁上之后，把钥匙丢了或者没有将钥匙还回去，那么结果就是这个柜子将无法供给任何人使用，也无法被垃圾回收器回收，因为找不到他的任何信息。

  内存泄漏的堆积最终会导致内存溢出。

## **3、内存溢出的原因以及解决方法**

### **3.1、内存溢出的原因**

引起内存溢出的原因有很多种，小编列举一下常见的有以下几种：

1. 内存中加载的数据量过于庞大，如一次从数据库取出过多数据；
2. 集合类中有对对象的引用，使用完后未清空，使得JVM不能回收；
3. 代码中存在死循环或循环产生过多重复的对象实体；
4. 使用的第三方软件中的BUG；
5. 启动参数内存值设定的过小 。

### **3.2、内存溢出的解决方案：**

第一步，修改JVM启动参数，直接增加内存。(`-Xms`、`-Xmx` 参数一定不要忘记加)

第二步，检查错误日志，查看 “OutOfMemory” 错误前是否有其它异常或错误。

第三步，对代码进行走查和分析，找出可能发生内存溢出的位置。

重点排查以下几点：

```
1.检查对数据库查询中，是否有一次获得全部数据的查询。
 一般来说，如果一次取十万条记录到内存，就可能引起内存溢出。
 这个问题比较隐蔽，在上线前，数据库中数据较少，不容易出问题，上线后，
 数据库中数据多了，一次查询就有可能引起内存溢出。因此对于数据库查询尽量采用分页的方式查询。
 
2.检查代码中是否有死循环或递归调用。

3.检查是否有大循环重复产生新对象实体。

4.检查对数据库查询中，是否有一次获得全部数据的查询。
 一般来说，如果一次取十万条记录到内存，就可能引起内存溢出。
 这个问题比较隐蔽，在上线前，数据库中数据较少，不容易出问题，
 上线后，数据库中数据多了，一次查询就有可能引起内存溢出。因此对于数据库查询尽量采用分页的方式查询。

5.检查List、MAP等集合对象是否有使用完后，未清除的问题。
 List、MAP等集合对象会始终存有对对象的引用，使得这些对象不能被GC回收。
```

第四步，使用内存查看工具动态查看内存使用情况。